(()=>{"use strict";var e={n:s=>{var l=s&&s.__esModule?()=>s.default:()=>s;return e.d(l,{a:l}),l},d:(s,l)=>{for(var r in l)e.o(l,r)&&!e.o(s,r)&&Object.defineProperty(s,r,{enumerable:!0,get:l[r]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.wp.blocks,l=window.wp.i18n,r=window.wp.blockEditor,o=window.wp.components,t=window.wp.element,a=window.wp.apiFetch;var n=e.n(a);const c=window.ReactJSXRuntime;function b(e){if(!e)return(0,l.__)("just now","scrobbled-blocks");const s=Math.floor(Date.now()/1e3)-e;if(s<60)return(0,l.__)("just now","scrobbled-blocks");if(s<3600){const e=Math.floor(s/60);return 1===e?(0,l.__)("1 minute ago","scrobbled-blocks"):i((0,l.__)("%d minutes ago","scrobbled-blocks"),e)}if(s<86400){const e=Math.floor(s/3600);return 1===e?(0,l.__)("1 hour ago","scrobbled-blocks"):i((0,l.__)("%d hours ago","scrobbled-blocks"),e)}const r=Math.floor(s/86400);return 1===r?(0,l.__)("1 day ago","scrobbled-blocks"):i((0,l.__)("%d days ago","scrobbled-blocks"),r)}function i(e,...s){let l=0;return e.replace(/%[sd]/g,()=>s[l++])}const d=JSON.parse('{"UU":"scrobble-blocks/recently-played"}');(0,s.registerBlockType)(d.UU,{edit:function({attributes:e,setAttributes:s}){const{numberOfItems:a,layout:i,gridColumns:d,showArtwork:m,showTimestamp:u,linkToLastFm:h}=e,[k,_]=(0,t.useState)([]),[g,p]=(0,t.useState)(!0),[w,x]=(0,t.useState)(null),j=(0,r.useBlockProps)({className:`wp-block-scrobble-blocks-recently-played is-layout-${i}`,style:"grid"===i?{"--grid-columns":d}:void 0});(0,t.useEffect)(()=>{p(!0),x(null),n()({path:`/scrobble-blocks/v1/recent-tracks?limit=${a}`}).then(e=>{e.success?e.tracks&&e.tracks.length>0?_(e.tracks):(x((0,l.__)("No recent tracks found.","scrobbled-blocks")),_([])):(x(e.error),_([]))}).catch(e=>{x(e.message||(0,l.__)("Failed to fetch track data.","scrobbled-blocks")),_([])}).finally(()=>{p(!1)})},[a]);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.InspectorControls,{children:(0,c.jsxs)(o.PanelBody,{title:(0,l.__)("Display Settings","scrobbled-blocks"),children:[(0,c.jsx)(o.RangeControl,{label:(0,l.__)("Number of tracks","scrobbled-blocks"),value:a,onChange:e=>s({numberOfItems:e}),min:1,max:20}),(0,c.jsxs)(o.__experimentalToggleGroupControl,{label:(0,l.__)("Layout","scrobbled-blocks"),value:i,onChange:e=>s({layout:e}),isBlock:!0,children:[(0,c.jsx)(o.__experimentalToggleGroupControlOption,{value:"list",label:(0,l.__)("List","scrobbled-blocks")}),(0,c.jsx)(o.__experimentalToggleGroupControlOption,{value:"grid",label:(0,l.__)("Grid","scrobbled-blocks")})]}),"grid"===i&&(0,c.jsx)(o.RangeControl,{label:(0,l.__)("Grid columns","scrobbled-blocks"),value:d,onChange:e=>s({gridColumns:e}),min:2,max:6}),(0,c.jsx)(o.ToggleControl,{label:(0,l.__)("Show artwork","scrobbled-blocks"),checked:m,onChange:e=>s({showArtwork:e})}),(0,c.jsx)(o.ToggleControl,{label:(0,l.__)("Show timestamp","scrobbled-blocks"),checked:u,onChange:e=>s({showTimestamp:e})}),(0,c.jsx)(o.ToggleControl,{label:(0,l.__)("Link to Last.fm","scrobbled-blocks"),checked:h,onChange:e=>s({linkToLastFm:e})})]})}),(0,c.jsxs)("div",{...j,children:[g&&(0,c.jsx)(o.Placeholder,{icon:"playlist-audio",label:(0,l.__)("Recently Played","scrobbled-blocks"),children:(0,c.jsx)(o.Spinner,{})}),!g&&w&&(0,c.jsx)(o.Placeholder,{icon:"playlist-audio",label:(0,l.__)("Recently Played","scrobbled-blocks"),children:(0,c.jsx)(o.Notice,{status:"warning",isDismissible:!1,children:w})}),!g&&!w&&k.length>0&&("list"===i?(0,c.jsx)("ul",{children:k.map((e,s)=>{const r=h?"a":"span",o=h?{href:e.url,target:"_blank",rel:"noopener noreferrer"}:{};return(0,c.jsxs)("li",{className:"scrobble-item",children:[m&&(0,c.jsx)("div",{className:"scrobble-artwork",children:h?(0,c.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:(0,c.jsx)("img",{src:e.artwork,alt:`${e.album} by ${e.artist}`})}):(0,c.jsx)("img",{src:e.artwork,alt:`${e.album} by ${e.artist}`})}),(0,c.jsxs)("div",{className:"scrobble-info",children:[(0,c.jsx)("span",{className:"scrobble-track",children:(0,c.jsx)(r,{...o,children:e.name})}),(0,c.jsx)("span",{className:"scrobble-artist",children:e.artist}),u&&(0,c.jsx)("time",{className:"scrobble-timestamp",children:e.nowplaying?(0,l.__)("Playing now","scrobbled-blocks"):b(e.timestamp)})]})]},s)})}):(0,c.jsx)(c.Fragment,{children:k.map((e,s)=>{const r=h?"a":"span",o=h?{href:e.url,target:"_blank",rel:"noopener noreferrer"}:{};return(0,c.jsxs)("div",{className:"scrobble-item",children:[m&&(0,c.jsx)("div",{className:"scrobble-artwork",children:h?(0,c.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:(0,c.jsx)("img",{src:e.artwork,alt:`${e.album} by ${e.artist}`})}):(0,c.jsx)("img",{src:e.artwork,alt:`${e.album} by ${e.artist}`})}),(0,c.jsxs)("div",{className:"scrobble-info",children:[(0,c.jsx)("span",{className:"scrobble-track",children:(0,c.jsx)(r,{...o,children:e.name})}),(0,c.jsx)("span",{className:"scrobble-artist",children:e.artist}),u&&(0,c.jsx)("time",{className:"scrobble-timestamp",children:e.nowplaying?(0,l.__)("Playing now","scrobbled-blocks"):b(e.timestamp)})]})]},s)})}))]})]})}})})();