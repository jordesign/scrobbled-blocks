(()=>{"use strict";var e={n:o=>{var s=o&&o.__esModule?()=>o.default:()=>o;return e.d(s,{a:s}),s},d:(o,s)=>{for(var r in s)e.o(s,r)&&!e.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:s[r]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const o=window.wp.blocks,s=window.wp.i18n,r=window.wp.blockEditor,l=window.wp.components,t=window.wp.element,n=window.wp.apiFetch;var c=e.n(n);const a=window.ReactJSXRuntime;function b(e){if(!e)return(0,s.__)("just now","scrobbled-blocks");const o=Math.floor(Date.now()/1e3)-e;if(o<60)return(0,s.__)("just now","scrobbled-blocks");if(o<3600){const e=Math.floor(o/60);return 1===e?(0,s.__)("1 minute ago","scrobbled-blocks"):i((0,s.__)("%d minutes ago","scrobbled-blocks"),e)}if(o<86400){const e=Math.floor(o/3600);return 1===e?(0,s.__)("1 hour ago","scrobbled-blocks"):i((0,s.__)("%d hours ago","scrobbled-blocks"),e)}const r=Math.floor(o/86400);return 1===r?(0,s.__)("1 day ago","scrobbled-blocks"):i((0,s.__)("%d days ago","scrobbled-blocks"),r)}function i(e,...o){let s=0;return e.replace(/%[sd]/g,()=>o[s++])}const d=JSON.parse('{"UU":"scrobble-blocks/now-playing"}');(0,o.registerBlockType)(d.UU,{edit:function({attributes:e,setAttributes:o}){const{showArtwork:n,artworkSize:i,showTimestamp:d,linkToLastFm:k}=e,[u,w]=(0,t.useState)(null),[h,m]=(0,t.useState)(!0),[_,g]=(0,t.useState)(null),p=(0,r.useBlockProps)({className:"wp-block-scrobble-blocks-now-playing",style:{"--scrobble-artwork-size":`${i}px`}});return(0,t.useEffect)(()=>{m(!0),g(null),c()({path:"/scrobble-blocks/v1/recent-tracks?limit=1"}).then(e=>{e.success?e.tracks&&e.tracks.length>0?w(e.tracks[0]):(g((0,s.__)("No recent tracks found.","scrobbled-blocks")),w(null)):(g(e.error),w(null))}).catch(e=>{g(e.message||(0,s.__)("Failed to fetch track data.","scrobbled-blocks")),w(null)}).finally(()=>{m(!1)})},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.InspectorControls,{children:(0,a.jsxs)(l.PanelBody,{title:(0,s.__)("Display Settings","scrobbled-blocks"),children:[(0,a.jsx)(l.ToggleControl,{label:(0,s.__)("Show artwork","scrobbled-blocks"),checked:n,onChange:e=>o({showArtwork:e})}),n&&(0,a.jsx)(l.RangeControl,{label:(0,s.__)("Artwork size","scrobbled-blocks"),value:i,onChange:e=>o({artworkSize:e}),min:48,max:200,step:8}),(0,a.jsx)(l.ToggleControl,{label:(0,s.__)("Show timestamp","scrobbled-blocks"),checked:d,onChange:e=>o({showTimestamp:e})}),(0,a.jsx)(l.ToggleControl,{label:(0,s.__)("Link to Last.fm","scrobbled-blocks"),checked:k,onChange:e=>o({linkToLastFm:e})})]})}),(0,a.jsxs)("div",{...p,children:[h&&(0,a.jsx)(l.Placeholder,{icon:"controls-volumeon",label:(0,s.__)("Now Playing","scrobbled-blocks"),children:(0,a.jsx)(l.Spinner,{})}),!h&&_&&(0,a.jsx)(l.Placeholder,{icon:"controls-volumeon",label:(0,s.__)("Now Playing","scrobbled-blocks"),children:(0,a.jsx)(l.Notice,{status:"warning",isDismissible:!1,children:_})}),!h&&!_&&u&&(()=>{if(!u)return null;const e=k?"a":"span",o=k?{href:u.url,target:"_blank",rel:"noopener noreferrer"}:{};return(0,a.jsxs)(a.Fragment,{children:[n&&(0,a.jsx)("div",{className:"scrobble-artwork",children:k?(0,a.jsx)("a",{href:u.url,target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)("img",{src:u.artwork,alt:`${u.album} by ${u.artist}`})}):(0,a.jsx)("img",{src:u.artwork,alt:`${u.album} by ${u.artist}`})}),(0,a.jsxs)("div",{className:"scrobble-info",children:[(0,a.jsx)("span",{className:"scrobble-track",children:(0,a.jsx)(e,{...o,children:u.name})}),(0,a.jsx)("span",{className:"scrobble-artist",children:u.artist}),d&&(0,a.jsx)("time",{className:"scrobble-timestamp",children:u.nowplaying?(0,s.__)("Playing now","scrobbled-blocks"):b(u.timestamp)})]})]})})()]})]})}})})();