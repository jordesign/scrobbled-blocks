(()=>{"use strict";var e={n:o=>{var s=o&&o.__esModule?()=>o.default:()=>o;return e.d(s,{a:s}),s},d:(o,s)=>{for(var l in s)e.o(s,l)&&!e.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:s[l]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const o=window.wp.blocks,s=window.wp.i18n,l=window.wp.blockEditor,r=window.wp.components,t=window.wp.element,n=window.wp.apiFetch;var c=e.n(n);const a=window.ReactJSXRuntime;function b(e){if(!e)return(0,s.__)("just now","scrobbled-blocks");const o=Math.floor(Date.now()/1e3)-e;if(o<60)return(0,s.__)("just now","scrobbled-blocks");if(o<3600){const e=Math.floor(o/60);return 1===e?(0,s.__)("1 minute ago","scrobbled-blocks"):i((0,s.__)("%d minutes ago","scrobbled-blocks"),e)}if(o<86400){const e=Math.floor(o/3600);return 1===e?(0,s.__)("1 hour ago","scrobbled-blocks"):i((0,s.__)("%d hours ago","scrobbled-blocks"),e)}const l=Math.floor(o/86400);return 1===l?(0,s.__)("1 day ago","scrobbled-blocks"):i((0,s.__)("%d days ago","scrobbled-blocks"),l)}function i(e,...o){let s=0;return e.replace(/%[sd]/g,()=>o[s++])}const d=JSON.parse('{"UU":"scrobble-blocks/now-playing"}');(0,o.registerBlockType)(d.UU,{edit:function({attributes:e,setAttributes:o}){const{showArtwork:n,showTimestamp:i,linkToLastFm:d}=e,[u,k]=(0,t.useState)(null),[w,h]=(0,t.useState)(!0),[_,m]=(0,t.useState)(null),p=(0,l.useBlockProps)({className:"wp-block-scrobble-blocks-now-playing"});return(0,t.useEffect)(()=>{h(!0),m(null),c()({path:"/scrobble-blocks/v1/recent-tracks?limit=1"}).then(e=>{e.success?e.tracks&&e.tracks.length>0?k(e.tracks[0]):(m((0,s.__)("No recent tracks found.","scrobbled-blocks")),k(null)):(m(e.error),k(null))}).catch(e=>{m(e.message||(0,s.__)("Failed to fetch track data.","scrobbled-blocks")),k(null)}).finally(()=>{h(!1)})},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.InspectorControls,{children:(0,a.jsxs)(r.PanelBody,{title:(0,s.__)("Display Settings","scrobbled-blocks"),children:[(0,a.jsx)(r.ToggleControl,{label:(0,s.__)("Show artwork","scrobbled-blocks"),checked:n,onChange:e=>o({showArtwork:e})}),(0,a.jsx)(r.ToggleControl,{label:(0,s.__)("Show timestamp","scrobbled-blocks"),checked:i,onChange:e=>o({showTimestamp:e})}),(0,a.jsx)(r.ToggleControl,{label:(0,s.__)("Link to Last.fm","scrobbled-blocks"),checked:d,onChange:e=>o({linkToLastFm:e})})]})}),(0,a.jsxs)("div",{...p,children:[w&&(0,a.jsx)(r.Placeholder,{icon:"controls-volumeon",label:(0,s.__)("Now Playing","scrobbled-blocks"),children:(0,a.jsx)(r.Spinner,{})}),!w&&_&&(0,a.jsx)(r.Placeholder,{icon:"controls-volumeon",label:(0,s.__)("Now Playing","scrobbled-blocks"),children:(0,a.jsx)(r.Notice,{status:"warning",isDismissible:!1,children:_})}),!w&&!_&&u&&(()=>{if(!u)return null;const e=d?"a":"span",o=d?{href:u.url,target:"_blank",rel:"noopener noreferrer"}:{};return(0,a.jsxs)(a.Fragment,{children:[n&&(0,a.jsx)("div",{className:"scrobble-artwork",children:(0,a.jsx)("img",{src:u.artwork,alt:`${u.album} by ${u.artist}`})}),(0,a.jsxs)("div",{className:"scrobble-info",children:[(0,a.jsx)("span",{className:"scrobble-track",children:(0,a.jsx)(e,{...o,children:u.name})}),(0,a.jsx)("span",{className:"scrobble-artist",children:u.artist}),i&&(0,a.jsx)("time",{className:"scrobble-timestamp",children:u.nowplaying?(0,s.__)("Playing now","scrobbled-blocks"):b(u.timestamp)})]})]})})()]})]})}})})();